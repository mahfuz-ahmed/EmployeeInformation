@model IEnumerable<EmployeeInfo.Models.EmployeeDesignation>

@{
    ViewData["Title"] = "Designations";
}

@if (TempData["ErrorMessage"] != null)
{
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="bi bi-exclamation-triangle me-2"></i> @TempData["ErrorMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i> @TempData["SuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

<div class="row mb-3">
    <div class="col-md-12 text-start">
        <a asp-action="Create" class="btn btn-primary">
            <i class="bi bi-plus-lg me-1"></i> Add New
        </a>
    </div>
</div>

<div class="row mb-3">
    <div class="col-md-12">
        <table id="designationTable" class="table table-striped table-bordered w-100">
            <thead>
                <tr>
                    <th>@Html.DisplayNameFor(model => model.DesignationName)</th>
                    <th class="no-export" style="width: 120px;">Actions</th>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <!-- DataTables Buttons CSS -->
    <link href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" rel="stylesheet" />

    <!-- DataTables + Buttons JS -->
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>

    <script>
        $(document).ready(function () {
            $("#designationTable").DataTable({
                processing: false,
                serverSide: true,
                ajax: {
                    url: "/Designation/GetDesignations",
                    type: "GET",
                    data: function (d) {
                        return {
                            page: (d.start / d.length) + 1,
                            pageSize: d.length,
                            searchTerm: d.search.value
                        };
                    },
                    dataSrc: function (json) {
                        json.recordsTotal = json.totalCount;
                        json.recordsFiltered = json.totalCount;
                        return json.data;
                    }
                },
                columns: [
                    { data: "designationName" },
                    {
                        data: "designationId",
                        render: function (data) {
                            return `
                                <div class="text-center">
                                    <a href="/Designation/Edit/${data}" class="btn btn-sm btn-warning">Edit</a>
                                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#commonDeleteModal" 
                                            data-id="${data}" data-url="/Designation/Delete/" 
                                            data-message="Are you sure you want to delete this designation?">
                                        Delete
                                    </button>
                                </div>
                            `;
                        },
                        orderable: false,
                        className: "no-export"
                    },
                ],
                searching: false,
                dom: "<'row mb-2 align-items-center'<'col-auto'l><'col text-end'B>>rtip",
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: 'Excel',
                        className: 'btn btn-success btn-sm me-1',
                        exportOptions: { columns: ':not(.no-export)' }
                    },
                    {
                        extend: 'pdfHtml5',
                        text: 'PDF',
                        className: 'btn btn-danger btn-sm',
                        exportOptions: { columns: ':not(.no-export)' }
                    }
                ]
            });
        });
    </script>
}
